<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>p3Dj9aCt04K9</title>
  </head>
  <body>
    <div id="info"></div>
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script>
    <script src="//cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@2/dist/fingerprint2.min.js"></script>
    <script>
      let ip_v6
      // $.get('https://www.cloudflare.com/cdn-cgi/trace', function (data) {
      //   ip_v6 = data
      //     .trim()
      //     .split('\n')
      //     .reduce(function (obj, pair) {
      //       pair = pair.split('=')
      //       return (obj[pair[0]] = pair[1]), obj
      //     }, {}).ip
      // })
      fetch('https://www.cloudflare.com/cdn-cgi/trace')
      .then((res) => res.text())
      .catch((error) => console.error('Error:', error))
      .then((data) => {
          ip_v6 = data
          .trim()
          .split('\n')
          .reduce(function (obj, pair) {
            pair = pair.split('=')
            return (obj[pair[0]] = pair[1]), obj
          }, {}).ip
      })
      async function getId() {
        let ip_v4
        await $.getJSON('https://api.ipify.org?format=jsonp&callback=?', function (data) {
          ip_v4 = data.ip //取得ip位址
        })
        const options = {
          preprocessor: null,
          audio: {
            timeout: 1000,
            excludeIOS11: true,
          },
          fonts: {
            swfContainerId: 'fingerprintjs2',
            swfPath: 'flash/compiled/FontList.swf',
            userDefinedFonts: [],
            extendedJsFonts: false,
          },
          screen: {
            // 確保使用者旋轉手機時會ID保持一致
            detectScreenOrientation: true,
          },
          plugins: {
            sortPluginsFor: [/palemoon/i], //對瀏覽器插件的順序作排列
            excludeIE: false,
          },
          extraComponents: [],
          excludes: {
            userAgent: true, //用戶代理字串 https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Headers/User-Agent
            openDatabase: true, //Chrome、Edge得到一樣的值，firefox的value為空陣列
            // canvas: true, //由於系統的差別，字體渲染引擎不同，對抗鋸齒、次像素渲染等算法也不同，canvas將同樣的文字轉成圖片，得到的結果也是不同的。https://juejin.cn/post/6844903970180169742。https://browserleaks.com/canvas。渲染得到的圖片是以Data URL Base64編碼。
            // webgl: true,
            // webglVendorAndRenderer: true,
            // fonts: true,
            // audio: true, //Chrome、Edge得到一樣的值(124.04347527516)，firefox(35.7383295930922)。https://audiofingerprint.openwpm.com/
            deviceMemory: true,
            plugins: true,
            // fonts:true, //Chrome、Edge得到一樣的值(48種字體),firefox多了兩個
            pixelRatio: true, //設備像素比
            doNotTrack: true, //確保無痕模式也可以追蹤。chrome、edge顯示not available；firefox顯示unspecified。用戶可自行在瀏覽器調整不給追蹤，此參數無法解掉。
            adBlock: true, //是否安裝AdBlock (我有裝但是value為false?!)
            fontsFlash: true, //已安裝的Flash字體列表，flash不是主流了
            enumerateDevices: true, //列出有哪些多媒體的input與output可以用～例如：webcam、microphone這些可以使用(http://cloverhsc.blogspot.com/2018/09/webrtc-2-enumeratedevices.html)，但是不可靠，開啟新的分頁都會有不一樣的值(https://github.com/fingerprintjs/fingerprintjs/issues/375)。
            //後五個是預設，但是有寫options要補回去
          },
          NOT_AVAILABLE: 'not available',
          ERROR: 'error',
          EXCLUDED: 'excluded',
        }

        Fingerprint2.get(options, function (components) {
          const list = components.map(function (component) {
            return component
          })
          const values = components.map(function (component) {
            return component
          })
          list.unshift({ key: 'ip_v4', value: ip_v4 }, { key: 'ip_v6', value: ip_v6 })
          values.push(ip_v4) //把ip位置加入雜湊演算
          console.log(list)
          console.log(values)
          for (let i = 0; i < list.length; i++) {
            $('#info').append(`<h3>${list[i]['key']}:${list[i]['value']}</h3>`)
          }
          const id = Fingerprint2.x64hash128(values.join(''), 31) //MurmurHash3 非加密的雜湊演算法
          console.log(id)
        })
      }
    </script>
    <script>
      if (window.requestIdleCallback) {
        requestIdleCallback(getId)
      } else {
        setTimeout(getId, 500)
      }
      //"deviceMemory"，0.25,0.5,1,2,4,8。如果電腦裝8gb以上記憶體，則value為8，代表至少有8gb記憶體。
      //hardwareConcurrency 報告的值不一定是真實CPU核心數
      //screenResolution 真實值
    </script>
  </body>
</html>
